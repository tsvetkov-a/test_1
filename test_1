 function get_html(m_name varchar2, m_date date, m_params xmltype := null, m_attach clob := null) return clob as
    h clob := '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>{SUBJ}</title>
      <style type="text/css">
          #outlook a {padding:0;}
          body{width:100% !important; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%; margin:0; padding:0;}
          .ExternalClass {width:100%;}
          .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div {line-height: 100%;}
          #backgroundTable {margin:0; padding:0; width:100% !important; line-height: 100% !important;}
          img {outline:none; text-decoration:none; -ms-interpolation-mode: bicubic;}
          a img {border:none;}
          .image_fix {display:block;}
          p {margin: 1em 0;}
          h1, h2, h3, h4, h5, h6 {color: black !important;}
          h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {color: blue !important;}
          h1 a:active, h2 a:active,  h3 a:active, h4 a:active, h5 a:active, h6 a:active {color: red !important;}
          h1 a:visited, h2 a:visited,  h3 a:visited, h4 a:visited, h5 a:visited, h6 a:visited {color: purple !important;}
          table td {border-collapse: collapse;}
          a {color: blue !important;}
          a:active {color: red !important;}
          a:visited {color: purple !important;}
		  .right_align {text-align:right}
      </style>
  </head>
	<body>
		<table>
			<tr><th class="right_align">Кому:</th><td>{RECIPIENT}</td></tr>
			<tr><th class="right_align">От:</th><td>{SENDER}</td></tr>
			<tr><th class="right_align">Тема:</th><td>{SUBJ}</td></tr>
			<tr><th class="right_align">Дата:</th><td>{SENDDATE}</td></tr>
		</table>
		{ATTACHMENTS}
		<table cellpadding="0" cellspacing="0" border="0" id="backgroundTable">
			<tr><td>{BODY}</td></tr>
		</table>
	</body>
</html>';
    sender varchar2(4000);
    rcp varchar2(4000);
    m_subj varchar2(4000);
    m_body clob;
    att xmltype;
    err clob;
  begin
    prepare_mail(m_name, m_date, m_params, sender, rcp, m_subj, m_body, att, err);
    h := replace(h, '{RECIPIENT}', rcp);
    h := replace(h, '{SENDER}', sender);
    h := replace(h, '{SUBJ}', m_subj);
    h := replace(h, '{SENDDATE}', to_char(m_date, 'dd.mm.yyyy hh24:mi:ss'));
    h := replace(h, '{BODY}', m_body);
    h := replace(h, '{ATTACHMENTS}', m_attach);
    return h;
  end get_html;

