FUNCTION check_ng_5apk3(o_id NUMBER) RETURN VARCHAR2 IS
    res VARCHAR2(1) := 'N';
  BEGIN
    SELECT 'Y' INTO res
    FROM ppo_voldates w, class_works cw
    WHERE w.ord_id = o_id
      AND cw.complex = w.CATEGORY
      AND cw.NAME = w.kind
      AND cw.department = w.executor
      AND cw.priority IS NOT NULL
      AND cw.ng = '5апк3'
      AND ROWNUM = 1 ;

    RETURN res;
  EXCEPTION
    WHEN OTHERS THEN
      RETURN res;
  END;
  
  
  FUNCTION get_days(v_volume NUMBER, w_ng VARCHAR2, s_ro_id NUMBER, w_name VARCHAR2) RETURN NUMBER IS
    res       NUMBER;
    v_str1    VARCHAR2(255);
    v_str2    VARCHAR2(255);
  BEGIN
    IF w_ng IS NOT NULL THEN
      v_str1 := 'работы "'||w_name||'"';
      v_str2 := 'работу "'||w_name||'"';
    ELSIF s_ro_id IS NOT NULL THEN
      v_str1 := 'операции "'||w_name||'"';
      v_str2 := 'операцию "'||w_name||'"';
    END IF;

    IF v_volume > 0 THEN
      -- Определение нормы времени
      BEGIN
        SELECT days INTO res
        FROM class_norms cn
        WHERE (cn.ng = w_ng OR cn.ro_id = s_ro_id)
          AND cn.period = v_period
          AND cn.terr_type = v_terr_type
          AND v_volume BETWEEN cn.minval AND cn.maxval
          AND cn.e_date IS NULL;
      EXCEPTION
        WHEN OTHERS THEN
          res_msg := 'Невозможно определить норму времени для '||v_str1||' !!!';
          RAISE;
      END;
    ELSE
      res_msg := 'Введите объем в '||v_str2||' и перезапустите функцию !!!';
      RAISE NO_DATA_FOUND;
    END IF;

    RETURN res;
  END;
  определяет и возвращает количество дней, необходимых для выполнения заданного объема работы или операции, 
  исходя из данных в таблице class_norms, или выдает сообщение об ошибке, если такое определение невозможно или объем работы или операции не задан.
  
   FUNCTION get_terr(v_id NUMBER) RETURN VARCHAR2 IS
    res     VARCHAR2(1);
    w_id    ppo_voldates.id%TYPE;
    w_name  class_works.meaning%TYPE;

  BEGIN
  -- Работа или этап ?
    BEGIN
      SELECT w.id, cw.meaning INTO w_id, w_name
      FROM class_works cw, (
        SELECT w.id, w.CATEGORY, w.kind, w.executor
          FROM ppo_voldates w
          WHERE w.id = v_id AND w.voldate_type = 'WORK'
        UNION
        SELECT w.id, w.CATEGORY, w.kind, w.executor
          FROM ppo_voldates s, ppo_voldates w
          WHERE s.id = v_id AND s.voldate_type = 'STG' AND w.id = s.voldate_id
      ) w
      WHERE cw.complex = w.CATEGORY
        AND cw.NAME = w.kind
        AND cw.department = w.executor;
    EXCEPTION
      WHEN OTHERS THEN
      res_msg := 'Расчет сроков операций выполняется для работ или этапов !!!';
      RAISE;
    END;

    IF w_id != v_id THEN
      -- сначала проверяем наличие сметы по этапу
      BEGIN
        SELECT '1' INTO res
        FROM ppo_smeta_header_new sh
        WHERE sh.ppo_stages_id = v_id
          AND sh.smeta_type = 'П'
          AND ROWNUM = 1;
      EXCEPTION
        WHEN OTHERS THEN NULL;
      END;
    END IF;

    IF res LIKE '1' THEN
      -- будем проверять спецрежим в смете по этапу
      w_id := v_id;
    ELSE
      -- проверяем наличие сметы по работе
      BEGIN
        SELECT '1' INTO res
        FROM ppo_smeta_header_new sh
        WHERE sh.ppo_stages_id = w_id
          AND sh.smeta_type = 'П'
          AND ROWNUM = 1;
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          res_msg := 'Работа "'||w_name||'" не осмечена, расставьте сроки вручную !!!';
          RAISE;
        WHEN OTHERS THEN
          res_msg := 'Ошибка при проверке сметы по работе "'||w_name||'" !!!';
          RAISE;
      END;
    END IF;

  -- Есть-ли спецрежим ?
    BEGIN
      SELECT 'С' INTO res
      FROM ppo_smeta_header_new sh, ppo_smeta_new s
      WHERE sh.ppo_stages_id = w_id
        AND sh.smeta_type = 'П'
        AND s.ppo_smeta_id = sh.id
        AND s.coeff_id = 12
        AND ROWNUM = 1;
    EXCEPTION
      WHEN NO_DATA_FOUND THEN
        res := NULL;
    END;

    RETURN NVL(res, 'О');
  END;
  проверяет наличие сметы для определенного этапа или работы, и возвращает специальный режим, если он существует, в противном случае возвращает 'О'.
  ppo_voldates, class_works, ppo_smeta_header_new, ppo_smeta_new
  
  
  
      FUNCTION get_volume(o_id NUMBER) RETURN NUMBER IS
      CURSOR c_vlm(o_id NUMBER, w_kind VARCHAR2) IS
        SELECT w.volume
        FROM ppo_voldates w
        WHERE w.ord_id = o_id
          AND w.kind = w_kind;
      vlm       NUMBER;
    BEGIN
      -- сначала из работы 101
      OPEN c_vlm(o_id, '101');
      FETCH c_vlm INTO vlm;
      CLOSE c_vlm;
      IF vlm IS NOT NULL THEN
        RETURN vlm;
      END IF;
      -- потом 102
      OPEN c_vlm(o_id, '102');
      FETCH c_vlm INTO vlm;
      CLOSE c_vlm;
      IF vlm IS NOT NULL THEN
        RETURN vlm;
      END IF;
      -- далее 112
      OPEN c_vlm(o_id, '112');
      FETCH c_vlm INTO vlm;
      CLOSE c_vlm;
      IF vlm IS NOT NULL THEN
        RETURN vlm;
      END IF;
      -- и 100
      OPEN c_vlm(o_id, '100');
      FETCH c_vlm INTO vlm;
      CLOSE c_vlm;
      IF vlm IS NOT NULL THEN
        RETURN vlm;
      END IF;
      -- не нашли :((((
      RETURN NULL;
    END;
    
    ppo_voldates
    
