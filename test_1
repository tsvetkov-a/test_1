procedure test_2(o_id number) is
begin
  for change in (
    select executor, xmlelement("TABLE", xmlforest(
      xmlforest('{ord_no}' as "TD", o.no as "TD") as "TR",
      xmlforest('{e_date}' as "TD", w.e_date as "TD") as "TR"
    )) x
    from ppo_orders o join ppo_voldates w on w.ord_id = o.id
    where w.kind = '1127'
    and o.done_doc_date is null
    and upper(o.no) not like '%test%'
    and upper(o.no) not like '%тест%'
    and w.e_date is not null -- Условие для проверки изменения даты планового окончания
    and w.e_date <> (select e_date from ppo_voldates where ord_id = o.id and kind = '1127') -- Условие для проверки новой даты
    and o.id = o_id
  ) loop
    if executor = 129376 THEN
      ref_mail.send('Изменение даты плана в заказах ОГХ (УГП №1)', change.x);
    elsif executor = 1293890 THEN
      ref_mail.send('Изменение даты плана в заказах ОГХ (УГП №2)', change.x);
    end if;
  end loop;
end test_2;
